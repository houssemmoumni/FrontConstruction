import { Component, Inject, PLATFORM_ID } from '@angular/core';
import { FormControl, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';
import { MatCardModule } from '@angular/material/card';
import { MatFormFieldModule } from '@angular/material/form-field';
import { MatInputModule } from '@angular/material/input';
import { MatButtonModule } from '@angular/material/button';
import { MatSelectModule } from '@angular/material/select';
import { NgIf } from '@angular/common';
import { FinancialReportService } from '../../../services/financial-report.service';
import { CustomizerSettingsService } from '../../../customizer-settings/customizer-settings.service';
import { SidebarComponent } from '../../../common/sidebar/sidebar.component';
import { MatSnackBar } from '@angular/material/snack-bar'; // Import MatSnackBar


@Component({
    selector: 'app-compose',
    templateUrl: './compose.component.html',
    styleUrl: './compose.component.scss',
    imports: [
        ReactiveFormsModule,
        MatCardModule,
        MatFormFieldModule,
        MatInputModule,
        MatButtonModule,
        MatSelectModule,
        NgIf,
        SidebarComponent
    ]
})
export class ComposeComponent {
    emailForm: FormGroup; // Form group for email data
    successMessage: string = ''; // Success message
    errorMessage: string = ''; // Error message

    constructor(
        @Inject(PLATFORM_ID) private platformId: Object,
        private financialReportService: FinancialReportService,
        public themeService: CustomizerSettingsService
    ) {
        this.emailForm = new FormGroup({
            email: new FormControl('', [Validators.required, Validators.email]),
            total_revenue: new FormControl('', [Validators.required]),
            net_profit: new FormControl('', [Validators.required]),
            date_rapport: new FormControl(new Date().toISOString().split('T')[0], [Validators.required]) // Default to today's date
        });
    }

    sendReport(): void {
        if (this.emailForm.invalid) {
            this.errorMessage = 'Please fill in all required fields.';
            return;
        }

        const report = {
            id_rapport: 1, // Example ID
            email: this.emailForm.value.email,
            total_revenue: this.emailForm.value.total_revenue,
            net_profit: this.emailForm.value.net_profit,
            date_rapport: this.emailForm.value.date_rapport,
            signature: 'data:image/png;base64,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N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JQAge5Ud1AZBBBAAAEE7AQIdDs3SiGAAAIIIOCUAIHuVHdQGQQQQAABBOwECHQ7N0ohgAACCCDglACB7lR3UBkEEEAAAQTsBAh0OzdKIYAAAggg4JTA/wONQyc3Ccj8TgAAAABJRU5ErkJggg==' // Replace <BASE64_SIGNATURE> with the actual Base64 string
        };

        console.log('Sending report:', report); // Debugging log

        this.financialReportService.downloadReport(report).subscribe(
            (blob) => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'rapport_financier.pdf';
                a.click();
                window.URL.revokeObjectURL(url);
                this.successMessage = 'PDF downloaded successfully!';
            },
            (error) => {
                this.errorMessage = 'Failed to download the report. Please try again.';
                console.error('Error downloading report:', error);
            }
        );
    }

    sendEmail(): void {
        if (this.emailForm.invalid) {
            this.errorMessage = 'Please fill in all required fields.';
            return;
        }

        const report = {
            id_rapport: 1, // Example ID
            email: this.emailForm.value.email,
            total_revenue: this.emailForm.value.total_revenue,
            net_profit: this.emailForm.value.net_profit,
            date_rapport: this.emailForm.value.date_rapport
        };

        this.financialReportService.sendFinancialReport(report).subscribe(
            (response) => {
                this.successMessage = response; // Use the response message from the backend
                this.errorMessage = '';
            },
            (error) => {
                this.errorMessage = error.message; // Display the specific error message
                console.error('Error sending email:', error);
            }
        );
    }
}