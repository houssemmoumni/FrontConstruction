<!-- src/app/incident-list/incident-list.component.html -->
<div class="container">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Incident Management</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="dataSource">
          <!-- Column definitions -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>ID</th>
            <td mat-cell *matCellDef="let element">{{element.id}}</td>
          </ng-container>

          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef>Description</th>
            <td mat-cell *matCellDef="let element">{{element.description}}</td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let element">
              <span [ngClass]="{
                'status-resolved': element.status === 'RESOLVED',
                'status-reopened': element.status === 'REOPENED',
                'status-new': element.status === 'NEW'
              }">
                {{element.status}}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="assignedTo">
            <th mat-header-cell *matHeaderCellDef>Assigned To</th>
            <td mat-cell *matCellDef="let element">
              {{element.assignedTechnician?.username || 'Unassigned'}}
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let element">
              <button mat-icon-button (click)="openAssignDialog(element)" *ngIf="element.status === 'REOPENED'">
                <mat-icon>assignment</mat-icon>
              </button>
            </td>
          </ng-container>

          <ng-container matColumnDef="history">
            <th mat-header-cell *matHeaderCellDef>History</th>
            <td mat-cell *matCellDef="let element">
              <div *ngFor="let event of element.history" class="history-item">
                <mat-icon>{{getHistoryIcon(event.action)}}</mat-icon>
                <div>
                  <strong>{{event.action}}</strong> by {{event.by}}<br>
                  <small>{{event.date | date:'medium'}}</small>
                </div>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>
