<div class="container">
    <div *ngIf="!selectedProject" class="project-cards-container">
      <mat-card *ngFor="let project of projects" class="project-card">
        <img mat-card-image [src]="project.image" alt="{{project.name}}" *ngIf="project.image">
        <mat-card-header>
          <mat-card-title>{{project.name}}</mat-card-title>
          <mat-card-subtitle>{{project.location}}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p>{{project.description}}</p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button color="primary" (click)="selectProject(project)">
            <mat-icon>report</mat-icon> DECLARE INCIDENT
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <div *ngIf="selectedProject" class="incident-form-container">
      <mat-card>
        <mat-card-header>
          <div class="header-content">
            <mat-card-title>Report Incident for {{selectedProject.name}}</mat-card-title>
            <button mat-icon-button (click)="cancel()">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </mat-card-header>

        <mat-card-content>
          <form (ngSubmit)="submitIncident()">
            <mat-form-field appearance="outline">
              <mat-label>Your Name</mat-label>
              <input matInput [(ngModel)]="incident.reporterName" name="reporterName" required>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Severity Level</mat-label>
              <mat-select [(ngModel)]="incident.severity" name="severity" required>
                <mat-option value="LOW">Low</mat-option>
                <mat-option value="MEDIUM">Medium</mat-option>
                <mat-option value="HIGH">High</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Incident Description</mat-label>
              <textarea matInput [(ngModel)]="incident.description" name="description" required rows="4"></textarea>
            </mat-form-field>

            <div class="form-actions">
              <button mat-button type="button" (click)="cancel()">CANCEL</button>
              <button mat-raised-button color="primary" type="submit" [disabled]="isSubmitting">
                SUBMIT INCIDENT
                <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </div>
</div>

